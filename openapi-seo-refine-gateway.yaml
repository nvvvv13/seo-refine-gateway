openapi: 3.1.0
info:
  title: SEO Refinement Gateway
  version: "1.0.0"
servers:
  - url: https://seo-refine-gateway.vercel.app
paths:
  /refine:
    post:
      operationId: refineQuestions
      summary: Refina e prioriza perguntas com base em ICP/keywords
      security:
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefineRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RefineResponse"
        "400":
          description: Invalid input
        "401":
          description: Unauthorized
        "429":
          description: Rate limited
        "500":
          description: Server error
components:
  securitySchemes:
    apiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
  schemas:
    Pergunta:
      type: object
      required: [tema, pergunta]
      properties:
        tema:
          type: string
        pergunta:
          type: string
        objetivo:
          type: string
          description: "atrair|comparar|converter (opcional)"
        funil:
          type: string
          description: "meio|fundo (opcional)"
    RefineRequest:
      type: object
      required: [icp, perguntas]
      properties:
        icp:
          type: string
        palavras_chave:
          type: array
          items:
            type: string
        contexto:
          type: object
          properties:
            produtos_foco:
              type: string
            site:
              type: string
            concorrentes:
              type: array
              items:
                type: string
        perguntas:
          type: array
          items:
            $ref: "#/components/schemas/Pergunta"
        parametros:
          type: object
          properties:
            ordenar_por:
              type: string
              enum: [relevancia, impacto, funil]
              default: relevancia
            remover_duplicadas:
              type: boolean
              default: true
            max_por_categoria:
              type: integer
              default: 100
    ItemRefinado:
      type: object
      properties:
        tema:
          type: string
        pergunta:
          type: string
        justificativa:
          type: string
        funil:
          type: string
          enum: [meio, fundo]
        objetivo:
          type: string
          enum: [atrair, comparar, converter]
        prioridade:
          type: integer
        categoria:
          type: string
    CategoriaRefinada:
      type: object
      properties:
        categoria:
          type: string
        prioridade:
          type: integer
        itens:
          type: array
          items:
            $ref: "#/components/schemas/ItemRefinado"
    RefineResponse:
      type: object
      properties:
        categorias:
          type: array
          items:
            $ref: "#/components/schemas/CategoriaRefinada"
        observacoes:
          type: string
